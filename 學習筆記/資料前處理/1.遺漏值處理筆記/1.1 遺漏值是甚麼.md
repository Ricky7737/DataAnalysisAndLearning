# 遺漏值是甚麼，還有如何處裡遺漏值
#### 而這個筆記參考 資料來源[1] 的教學文章，並選用 Kaggle Titanic 作為數據集練習
* Kaggle Titanic 資料連結 :  https://www.kaggle.com/competitions/titanic/data
## 1. 遺漏值介紹
### 1.1 遺漏值
#### 遺漏值在實際數據集中相當常見，而遺漏值會影響模型的 *性能* 或是 *準確度*。而遺漏值有不同形式的方式存在，所以我們必須選用合適的方法來處理。
* 遺漏值如下，會在資料中以 **NaN** 出現，代標這個格子缺乏一個數值
![image](https://github.com/Ricky7737/DataAnalysisAndLearning/assets/58324475/98eb04df-b4e8-4f74-8e7b-2340b8ec7d85)

### 1.2 遺漏值產生
  * 1.數據可能損壞或是不當維護缺失了數值
  * 2.可能某些原因人為遺漏的記錄的數值
  * 3.資料未被提供等因素
    
### 1.3 遺漏值種類 
#### 遺漏值有三種種類(MCAR、MNAR、MAR )
 * **1.MCAR(Missing Completely At Random, 隨機性的遺漏值)**
   ##### MCAR 數據缺失的概率對所有觀察值都是相同的，與數據其他變量無關。而這種遺漏值的產生可能是人為錯誤、系統或是設備故障。而這種遺漏值資料上來說分布比較不會影響資料的分布偏態。
   
 * **2.MAR(Missing At Random)**
   * 表示缺失數據的原因可以通過您擁有完整信息的變量來解釋，存在某種關係或模式。
   * 在MAR情況下，數據缺失的概率不同觀察值之間可能不同，但這種差異可以由其他已觀察到的變量來解釋
   * 缺失數據的出現取決於其他已知變量的值，但不能直接預測缺失值本身
   * 所以當這種遺漏值出現時，可能導致該資料出現偏差，所以必續特別處理確保分析不受到遺漏值的影響
   ##### 例如 : 今天做一個民意調查，然後性別為女性的受測者可能不願透漏年齡，就會變成遺漏值的形式出現
   
  * **3.MNAR(Missing Not At Random)**
    ##### MNAR 則表示遺漏值來自於未被觀察到的數據。例如在圖書館調查未歸還書籍的客人，可能無法接受該調查。或是說受訪者不願意在問卷中分享訊息

### 1.4 為甚麼要處理遺漏值
  * 1.許多機器學習演算法碰到遺漏值時可能會運算失敗。但部分方式有支持運算遺漏值的功能，例如 : K-nearest、Naive Bayes等
  * 2.如果未正確處理遺漏值，可能會導致最終訓練的模型 "預測" 或 "分類" 產生偏差
  * 3.如果忽略遺漏值，可能會使最後分析結果不夠精確，降低統計分析的結果可靠性，而無法有效解釋數據。

## 2. 遺漏值處理
### 2.1 知道遺漏值有多少個
#### 使用 Python 來檢查個欄位遺漏值
* 以 Titanic 的 train.csv 做為練習 :
    ```
    import pandas as pd
    row_TrainData = pd.read_csv(r'E:\DataLearn\4-Titanic\data\train.csv')
    #檢查個欄位遺漏值數字
    missing_TrainData = row_TrainData.isnull().sum()
    missing_TrainData
    
    out put:
    assengerId      0
    Survived         0
    Pclass           0
    Name             0
    Sex              0
    Age            177
    SibSp            0
    Parch            0
    Ticket           0
    Fare             0
    Cabin          687
    Embarked         2
    dtype: int64
    ```
##### 從上面可以看到 Age、Cabin 與 Embarked 都有遺漏值

### 2.2 遺漏值常見處理方式
  * 1.刪除遺漏值 : 包含刪除含有遺漏值的行或列。但可能會遺失部分數據
  * 2.填補遺漏值 : 使用 **統計方式(例如:平均值(mean)、中位數(median)等)** 或是 **機器學習模型(例如:回歸或是K-nearest)** 。但這個可能會使模型有一小部分的偏差存在。
    #### 以資料集中的 Age 欄位來做練習
    * **1. 計算 平均數(mean):** 
    ```
    import pandas as pd
    # 使用平均數來填補遺漏值
    mean_age_value = row_TrainData['Age'].mean().round().astype(int)
    print('age欄位平均數 : ', mean_age_value)
    
    out put :
    age欄位平均數 :  30
    ```
    * **2. 計算 中位數(mediam):** 
    ```
    median_age = row_TrainData['Age'].median()
    print('age欄位中位數 : ', median_age)

    output :
    age欄位中位數 :  28.0
    ```
    * **3. 計算 眾數(mode)**
    ```
    mode_age = row_TrainData['Age'].mode()
    # mode_age[0] 取出眾數列表中第一個眾數值
    print('age欄位最多的眾數 : ', mode_age[0])

    output :
    age欄位最多的眾數 :  24.0
    ```
    * **4.計算 標準差(std)**
    ```
    std_age = row_TrainData['Age'].std()
    print('age欄位標準差: ', std_age)

    output:
    age欄位標準差:  14.526497332334044
    ```
    #### 填補遺漏值
    * 可以使用 fillna() 語法如下
    ``` data['目標欄位'].fillna(要補入的數值, inplace=True)```
    * 舉例使用中位數來填補 age
    ```
    # 先備份一個要用來展示處理 age 遺漏值的數據集
    fillna_median_tain = row_TrainData.copy()
    # 填補遺漏值
    fillna_median_tain['Age'].fillna(median_age, inplace = True)
    fillna_median_tain['Age'].isnull().sum()

    output:
    0
    ```
    ##### 可以看到 age 欄位的 遺漏值被中位數填補後不在存在任何遺漏值

    #### 而這邊另外補充一個方法 method = ffill
    * method = ffill 為使用前一個數值來填補遺漏值本身，語法如下
    ```
    data = {'A': [1, 2, None, 4, None, 6, 7],
            'B': [None, 22, 23, None, 25, 26, None]}
    df = pd.DataFrame(data)
    df

    out:
        A	  B
    0	1.0	NaN
    1	2.0	22.0
    2	NaN	23.0
    3	4.0	NaN
    4	NaN	25.0
    5	6.0	26.0
    6 7.0	NaN

    # 填充遺漏值
    df_filled = df.fillna(method='ffill')
    print(df_filled)

    out:
        A     B
    0  1.0   NaN
    1  2.0  22.0
    2  2.0  23.0
    3  4.0  23.0
    4  4.0  25.0
    5  6.0  26.0
    6  7.0  26.0
    ```
    
  * **3.透過 interpolate  來插入數值**
    #### 其中方式有 : polynomial(多項式)、linear(線性) 或 quadratic(二次插值) 等方式。而默認的方法是 linear(線性插入)
    * 語法
    ```
    df_fillnull_Linear = df.interpolate()
    df_fillnull_Linear

    out :
    	  A	  B
    0	1.0	NaN
    1	2.0	22.0
    2	3.0	23.0
    3	4.0	24.0
    4	5.0	25.0
    5	6.0	26.0
    6	7.0	26.0
    ```
  * **4.對分類特徵添補遺漏值 :** 當特徵中屬於分類時，可以適當填補以處理遺漏
    * ** 1.使用 sklearn 的 SimpleImputer**
      #### SimpleInputer 為 Sklearn 提供用來補足數據遺漏值的方式。透過 ```strategy='strategy_name'``` 選擇填補方式。方式如下 :
        ##### 針對數值型資料
        * **mean :** 使用平均值填充
        * **median :** 使用中位數填充
        * **constant :** 使用指定的常數填充
        ###### 針對類別型資料
        * **most_frequent :** 使用常見的類別來填充資料 
    ```
    # 首先先創造一個帶有空值的資料
    X = pd.DataFrame({'shape':['Apple', 'banana', 'banna', 'orange', np.nan]})
    X

    out :
      shape
    0	Apple
    1	banana
    2	banna
    3	orange
    4	NaN
    --------------------------------------------------------
    
    ```






#### 參考資料來源 :
* [1] https://www.analyticsvidhya.com/blog/2021/10/handling-missing-value/















